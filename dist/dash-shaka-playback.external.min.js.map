{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///dash-shaka-playback.external.min.js","webpack:///webpack/bootstrap 3a99294a8fe7f218382a","webpack:///./src/clappr-dash-shaka-playback.js","webpack:///external {\"amd\":\"clappr\",\"commonjs\":\"clappr\",\"commonjs2\":\"clappr\",\"root\":\"Clappr\"}","webpack:///external \"shaka\""],"names":["root","factory","exports","module","require","define","amd","self","this","__WEBPACK_EXTERNAL_MODULE_1__","__WEBPACK_EXTERNAL_MODULE_2__","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","constructor","value","writable","setPrototypeOf","__proto__","_get","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getPrototypeOf","_createClass","defineProperties","target","props","length","descriptor","key","protoProps","staticProps","_clappr","_shakaPlayer","_shakaPlayer2","obj","default","DashShakaPlayback","_HTML5Video","options","_this","_levels","_pendingAdaptationEvent","_isShakaReadyState","_activeAudioLanguage","autoPlay","play","player","Player","version","_player","set","id","_this2","_currentLevelId","isAuto","trigger","Events","PLAYBACK_LEVEL_SWITCH_START","configure","abr","enabled","PLAYBACK_LEVEL_SWITCH_END","selectTrack","videoTracks","filter","t","resource","mimeType","arguments","polyfill","installAll","browserSupported","isBrowserSupported","resourceParts","split","match","indexOf","SHAKA_READY","_setup","isReady","once","_stopped","_src","el","src","PLAYBACK_READY","event","Log","error","highDefinition","_this3","clearInterval","sendStatsId","_sendStats","unload","then","catch","isLive","track","clearBuffer","type","selectTextTrack","selectVariantTrack","startsWith","_onAdaptation","Error","language","role","selectAudioLanguage","isEnable","textTracks","_shakaTTVisible","Array","from","kind","forEach","mode","_ccIsSetup","hasClosedCaptionsTracks","PLAYBACK_SUBTITLE_AVAILABLE","trackId","closedCaptionsTrackId","_this4","destroy","_destroy","_this5","_createPlayer","_options","shakaConfiguration","shakaOnBeforeLoad","preferredAudioLanguage","getConfiguration","load","_loaded","e","_setupError","addEventListener","_onError","bind","_onBuffering","buffering","PLAYBACK_BUFFERING","PLAYBACK_BUFFERFULL","_onShakaReady","_startToSendStats","_fillLevels","_checkForClosedCaptions","map","videoTrack","label","height","reverse","PLAYBACK_LEVELS_AVAILABLE","levels","_this6","intervalMs","shakaSendStatsInterval","setInterval","PLAYBACK_STATS_ADD","getStats","err","PLAYBACK_ERROR","activeVideo","active","_pendingAdaptationEvent_","debug","PLAYBACK_HIGHDEFINITIONUPDATE","PLAYBACK_BITRATE","bandwidth","width","level","isAudioOnly","getTextTracks","getVariantTracks","getAudioLanguages","audioLanguages","tracks","closedCaptionsTracks","showingTrack","find","warn","info","_enableShakaTextTrack","_ccTrackId","PLAYBACK_SUBTITLE_CHANGED","HTML5Video"],"mappings":"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","file":"dash-shaka-playback.external.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"clappr\"), require(\"shaka\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"clappr\", \"shaka\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DashShakaPlayback\"] = factory(require(\"clappr\"), require(\"shaka\"));\n\telse\n\t\troot[\"DashShakaPlayback\"] = factory(root[\"Clappr\"], root[\"shaka\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"clappr\"), require(\"shaka\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"clappr\", \"shaka\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DashShakaPlayback\"] = factory(require(\"clappr\"), require(\"shaka\"));\n\telse\n\t\troot[\"DashShakaPlayback\"] = factory(root[\"Clappr\"], root[\"shaka\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _clappr = __webpack_require__(1);\n\nvar _shakaPlayer = __webpack_require__(2);\n\nvar _shakaPlayer2 = _interopRequireDefault(_shakaPlayer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SEND_STATS_INTERVAL_MS = 30 * 1e3;\nvar DEFAULT_LEVEL_AUTO = -1;\n\nvar DashShakaPlayback = function (_HTML5Video) {\n  _inherits(DashShakaPlayback, _HTML5Video);\n\n  _createClass(DashShakaPlayback, [{\n    key: 'name',\n    get: function get() {\n      return 'dash_shaka_playback';\n    }\n  }, {\n    key: 'shakaVersion',\n    get: function get() {\n      return _shakaPlayer2.default.player.Player.version;\n    }\n  }, {\n    key: 'shakaPlayerInstance',\n    get: function get() {\n      return this._player;\n    }\n  }, {\n    key: 'levels',\n    get: function get() {\n      return this._levels;\n    }\n  }, {\n    key: 'currentLevel',\n    set: function set(id) {\n      var _this2 = this;\n\n      this._currentLevelId = id;\n      var isAuto = this._currentLevelId === DEFAULT_LEVEL_AUTO;\n\n      this.trigger(_clappr.Events.PLAYBACK_LEVEL_SWITCH_START);\n      if (!isAuto) {\n        this._player.configure({ abr: { enabled: false } });\n        this._pendingAdaptationEvent = true;\n        this.selectTrack(this.videoTracks.filter(function (t) {\n          return t.id === _this2._currentLevelId;\n        })[0]);\n      } else {\n        this._player.configure({ abr: { enabled: true } });\n        this.trigger(_clappr.Events.PLAYBACK_LEVEL_SWITCH_END);\n      }\n    },\n    get: function get() {\n      return this._currentLevelId || DEFAULT_LEVEL_AUTO;\n    }\n  }], [{\n    key: 'canPlay',\n    value: function canPlay(resource) {\n      var mimeType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n      _shakaPlayer2.default.polyfill.installAll();\n      var browserSupported = _shakaPlayer2.default.Player.isBrowserSupported();\n      var resourceParts = resource.split('?')[0].match(/.*\\.(.*)$/) || [];\n      return browserSupported && (resourceParts[1] === 'mpd' || mimeType.indexOf('application/dash+xml') > -1);\n    }\n  }, {\n    key: 'Events',\n    get: function get() {\n      return {\n        SHAKA_READY: 'shaka:ready'\n      };\n    }\n  }]);\n\n  function DashShakaPlayback(options) {\n    _classCallCheck(this, DashShakaPlayback);\n\n    var _this = _possibleConstructorReturn(this, (DashShakaPlayback.__proto__ || Object.getPrototypeOf(DashShakaPlayback)).call(this, options));\n\n    _this._levels = [];\n    _this._pendingAdaptationEvent = false;\n    _this._isShakaReadyState = false;\n    _this._activeAudioLanguage = null;\n\n    options.autoPlay && _this.play();\n    return _this;\n  }\n\n  _createClass(DashShakaPlayback, [{\n    key: 'play',\n    value: function play() {\n      if (!this._player) {\n        this._setup();\n      }\n\n      if (!this.isReady) {\n        this.once(DashShakaPlayback.Events.SHAKA_READY, this.play);\n        return;\n      }\n\n      this._stopped = false;\n      this._src = this.el.src;\n      _get(DashShakaPlayback.prototype.__proto__ || Object.getPrototypeOf(DashShakaPlayback.prototype), 'play', this).call(this);\n    }\n\n    // skipping setup `setupSrc` on tag video\n\n  }, {\n    key: 'setupSrc',\n    value: function setupSrc() {}\n\n    // skipping ready event on video tag in favor of ready on shaka\n\n  }, {\n    key: '_ready',\n    value: function _ready() {\n      // override with no-op\n    }\n  }, {\n    key: '_onShakaReady',\n    value: function _onShakaReady() {\n      this._isShakaReadyState = true;\n      this.trigger(DashShakaPlayback.Events.SHAKA_READY);\n      this.trigger(_clappr.Events.PLAYBACK_READY, this.name);\n    }\n  }, {\n    key: 'error',\n\n\n    // skipping error handling on video tag in favor of error on shaka\n    value: function error(event) {\n      _clappr.Log.error('an error was raised by the video tag', event, this.el.error);\n    }\n  }, {\n    key: 'isHighDefinitionInUse',\n    value: function isHighDefinitionInUse() {\n      return !!this.highDefinition;\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      var _this3 = this;\n\n      clearInterval(this.sendStatsId);\n      this._stopped = true;\n\n      if (this._player) {\n        this._sendStats();\n\n        this._player.unload().then(function () {\n          _get(DashShakaPlayback.prototype.__proto__ || Object.getPrototypeOf(DashShakaPlayback.prototype), 'stop', _this3).call(_this3);\n          _this3._player = null;\n          _this3._isShakaReadyState = false;\n        }).catch(function () {\n          _clappr.Log.error('shaka could not be unloaded');\n        });\n      } else {\n        _get(DashShakaPlayback.prototype.__proto__ || Object.getPrototypeOf(DashShakaPlayback.prototype), 'stop', this).call(this);\n      }\n    }\n\n    /**\n    * Determine if the playback does not contain video/has video but video should be ignored.\n    * @property isAudioOnly\n    * @type Boolean\n    */\n\n  }, {\n    key: 'getPlaybackType',\n    value: function getPlaybackType() {\n      return (this.isReady && this._player.isLive() ? 'live' : 'vod') || '';\n    }\n  }, {\n    key: 'selectTrack',\n    value: function selectTrack(track, clearBuffer) {\n      if (!this.isReady) {\n        return false;\n      }\n      switch (track.type) {\n        case 'text':\n          this._player.selectTextTrack(track);\n          return true;\n        case 'variant':\n          this._player.selectVariantTrack(track, clearBuffer);\n          if (track.mimeType.startsWith('video/')) {\n            // we trigger the adaptation event here\n            // because Shaka doesn't trigger its event on \"manual\" selection.\n            this._onAdaptation();\n          }\n          return true;\n        default:\n          throw new Error('Unhandled track type:', track.type);\n      }\n    }\n  }, {\n    key: 'selectLanguage',\n    value: function selectLanguage(language, role) {\n      if (this.isReady) {\n        this._activeAudioLanguage = language;\n        this._player.selectAudioLanguage(language, role);\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: '_enableShakaTextTrack',\n    value: function _enableShakaTextTrack(isEnable) {\n      // Shaka player use only one TextTrack object with video element to handle all text tracks\n      // It must be enabled or disabled in addition to call selectTextTrack()\n      if (!this.el.textTracks) {\n        return;\n      }\n\n      this._shakaTTVisible = isEnable;\n\n      Array.from(this.el.textTracks).filter(function (track) {\n        return track.kind === 'subtitles';\n      }).forEach(function (track) {\n        return track.mode = isEnable === true ? 'showing' : 'hidden';\n      });\n    }\n  }, {\n    key: '_checkForClosedCaptions',\n    value: function _checkForClosedCaptions() {\n      if (this._ccIsSetup) {\n        return;\n      }\n\n      if (this.hasClosedCaptionsTracks) {\n        this.trigger(_clappr.Events.PLAYBACK_SUBTITLE_AVAILABLE);\n        var trackId = this.closedCaptionsTrackId;\n        this.closedCaptionsTrackId = trackId;\n      }\n      this._ccIsSetup = true;\n    }\n  }, {\n    key: 'destroy',\n    value: function destroy() {\n      var _this4 = this;\n\n      clearInterval(this.sendStatsId);\n\n      if (this._player) {\n        this._player.destroy().then(function () {\n          return _this4._destroy();\n        }).catch(function () {\n          _this4._destroy();\n          _clappr.Log.error('shaka could not be destroyed');\n        });\n      } else {\n        this._destroy();\n      }\n    }\n  }, {\n    key: '_setup',\n    value: function _setup() {\n      var _this5 = this;\n\n      this._isShakaReadyState = false;\n      this._ccIsSetup = false;\n      this._player = this._createPlayer();\n      this._options.shakaConfiguration && this._player.configure(this._options.shakaConfiguration);\n      this._options.shakaOnBeforeLoad && this._options.shakaOnBeforeLoad(this._player);\n\n      var preferredAudioLanguage = this._player.getConfiguration().preferredAudioLanguage;\n      this._activeAudioLanguage = preferredAudioLanguage.length ? preferredAudioLanguage : null;\n\n      var playerLoaded = this._player.load(this._options.src);\n      playerLoaded.then(function () {\n        return _this5._loaded();\n      }).catch(function (e) {\n        return _this5._setupError(e);\n      });\n    }\n  }, {\n    key: '_createPlayer',\n    value: function _createPlayer() {\n      var player = new _shakaPlayer2.default.Player(this.el);\n      player.addEventListener('error', this._onError.bind(this));\n      player.addEventListener('adaptation', this._onAdaptation.bind(this));\n      player.addEventListener('buffering', this._onBuffering.bind(this));\n      return player;\n    }\n  }, {\n    key: '_onBuffering',\n    value: function _onBuffering(e) {\n      if (this._stopped) return;\n      var event = e.buffering ? _clappr.Events.PLAYBACK_BUFFERING : _clappr.Events.PLAYBACK_BUFFERFULL;\n      this.trigger(event);\n    }\n  }, {\n    key: '_loaded',\n    value: function _loaded() {\n      this._onShakaReady();\n      this._startToSendStats();\n      this._fillLevels();\n      this._checkForClosedCaptions();\n    }\n  }, {\n    key: '_fillLevels',\n    value: function _fillLevels() {\n      if (this._levels.length === 0) {\n        this._levels = this.videoTracks.map(function (videoTrack) {\n          return { id: videoTrack.id, label: videoTrack.height + 'p' };\n        }).reverse();\n        this.trigger(_clappr.Events.PLAYBACK_LEVELS_AVAILABLE, this.levels);\n      }\n    }\n  }, {\n    key: '_startToSendStats',\n    value: function _startToSendStats() {\n      var _this6 = this;\n\n      var intervalMs = this._options.shakaSendStatsInterval || SEND_STATS_INTERVAL_MS;\n      this.sendStatsId = setInterval(function () {\n        return _this6._sendStats();\n      }, intervalMs);\n    }\n  }, {\n    key: '_sendStats',\n    value: function _sendStats() {\n      this.trigger(_clappr.Events.PLAYBACK_STATS_ADD, this._player.getStats());\n    }\n  }, {\n    key: '_setupError',\n    value: function _setupError(err) {\n      this._onError(err);\n    }\n  }, {\n    key: '_onError',\n    value: function _onError(err) {\n      _clappr.Log.error('Shaka error event:', err);\n      this.trigger(_clappr.Events.PLAYBACK_ERROR, err, this.name);\n    }\n  }, {\n    key: '_onAdaptation',\n    value: function _onAdaptation() {\n      var activeVideo = this.videoTracks.filter(function (t) {\n        return t.active === true;\n      })[0];\n\n      this._fillLevels();\n\n      // update stats that may have changed before we trigger event\n      // so that user can rely on stats data when handling event\n      this._sendStats();\n\n      if (this._pendingAdaptationEvent_) {\n        this.trigger(_clappr.Events.PLAYBACK_LEVEL_SWITCH_END);\n        this._pendingAdaptationEvent = false;\n      }\n\n      _clappr.Log.debug('an adaptation has happened:', activeVideo);\n      this.highDefinition = activeVideo.height >= 720;\n      this.trigger(_clappr.Events.PLAYBACK_HIGHDEFINITIONUPDATE, this.highDefinition);\n      this.trigger(_clappr.Events.PLAYBACK_BITRATE, {\n        bandwidth: activeVideo.bandwidth,\n        width: activeVideo.width,\n        height: activeVideo.height,\n        level: activeVideo.id\n      });\n    }\n  }, {\n    key: '_destroy',\n    value: function _destroy() {\n      _get(DashShakaPlayback.prototype.__proto__ || Object.getPrototypeOf(DashShakaPlayback.prototype), 'destroy', this).call(this);\n      this._isShakaReadyState = false;\n      _clappr.Log.debug('shaka was destroyed');\n    }\n  }, {\n    key: 'isReady',\n    get: function get() {\n      return this._isShakaReadyState;\n    }\n  }, {\n    key: 'isAudioOnly',\n    get: function get() {\n      return this.isReady ? this._player.isAudioOnly() : false;\n    }\n  }, {\n    key: 'textTracks',\n    get: function get() {\n      return this.isReady && this._player.getTextTracks();\n    }\n  }, {\n    key: 'audioTracks',\n    get: function get() {\n      return this.isReady && this._player.getVariantTracks().filter(function (t) {\n        return t.mimeType.startsWith('audio/');\n      });\n    }\n  }, {\n    key: 'videoTracks',\n    get: function get() {\n      return this.isReady && this._player.getVariantTracks().filter(function (t) {\n        return t.mimeType.startsWith('video/');\n      });\n    }\n  }, {\n    key: 'audioLanguages',\n    get: function get() {\n      return this.isReady && this._player.getAudioLanguages();\n    }\n  }, {\n    key: 'activeAudioLanguage',\n    get: function get() {\n      return this._activeAudioLanguage || this.audioLanguages[0] || null;\n    }\n\n    /**\n     * @override\n     */\n\n  }, {\n    key: 'closedCaptionsTracks',\n    get: function get() {\n      var id = 0;\n      var trackId = function trackId() {\n        return id++;\n      };\n      var tracks = this.textTracks || [];\n\n      return tracks.filter(function (track) {\n        return track.kind === 'subtitle';\n      }).map(function (track) {\n        return { id: trackId(), name: track.label || track.language, track: track };\n      });\n    }\n\n    /**\n     * @override\n     */\n\n  }, {\n    key: 'closedCaptionsTrackId',\n    get: function get() {\n      return _get(DashShakaPlayback.prototype.__proto__ || Object.getPrototypeOf(DashShakaPlayback.prototype), 'closedCaptionsTrackId', this);\n    }\n\n    /**\n     * @override\n     */\n    ,\n    set: function set(trackId) {\n      if (!this._player) {\n        return;\n      }\n\n      var tracks = this.closedCaptionsTracks;\n      var showingTrack = void 0;\n\n      // Note: -1 is for hide all tracks\n      if (trackId !== -1) {\n        showingTrack = tracks.find(function (track) {\n          return track.id === trackId;\n        });\n        if (!showingTrack) {\n          _clappr.Log.warn('Track id \"' + trackId + '\" not found');\n          return;\n        }\n        if (this._shakaTTVisible && showingTrack.track.active === true) {\n          _clappr.Log.info('Track id \"' + trackId + '\" already showing');\n          return;\n        }\n      }\n\n      if (showingTrack) {\n        this._player.selectTextTrack(showingTrack.track);\n        this._enableShakaTextTrack(true);\n      } else {\n        this._enableShakaTextTrack(false);\n      }\n\n      this._ccTrackId = trackId;\n      this.trigger(_clappr.Events.PLAYBACK_SUBTITLE_CHANGED, {\n        id: trackId\n      });\n    }\n  }]);\n\n  return DashShakaPlayback;\n}(_clappr.HTML5Video);\n\nexports.default = DashShakaPlayback;\nmodule.exports = exports['default'];\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// dash-shaka-playback.external.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3a99294a8fe7f218382a","import {HTML5Video, Log, Events} from 'clappr'\nimport shaka from 'shaka-player'\n\nconst SEND_STATS_INTERVAL_MS = 30 * 1e3\nconst DEFAULT_LEVEL_AUTO = -1\n\nclass DashShakaPlayback extends HTML5Video {\n  static get Events () {\n    return {\n      SHAKA_READY: 'shaka:ready'\n    }\n  }\n\n  static canPlay (resource, mimeType = '') {\n    shaka.polyfill.installAll()\n    let browserSupported = shaka.Player.isBrowserSupported()\n    let resourceParts = resource.split('?')[0].match(/.*\\.(.*)$/) || []\n    return browserSupported && ((resourceParts[1] === 'mpd') || mimeType.indexOf('application/dash+xml') > -1)\n  }\n\n  get name () {\n    return 'dash_shaka_playback'\n  }\n\n  get shakaVersion () {\n    return shaka.player.Player.version\n  }\n\n  get shakaPlayerInstance () {\n    return this._player\n  }\n\n  get levels () {\n    return this._levels\n  }\n\n  set currentLevel (id) {\n    this._currentLevelId = id\n    let isAuto = this._currentLevelId === DEFAULT_LEVEL_AUTO\n\n    this.trigger(Events.PLAYBACK_LEVEL_SWITCH_START)\n    if (!isAuto) {\n      this._player.configure({abr: {enabled: false}})\n      this._pendingAdaptationEvent = true\n      this.selectTrack(this.videoTracks.filter((t) => t.id === this._currentLevelId)[0])\n    }\n    else {\n      this._player.configure({abr: {enabled: true}})\n      this.trigger(Events.PLAYBACK_LEVEL_SWITCH_END)\n    }\n  }\n\n  get currentLevel () {\n    return this._currentLevelId || DEFAULT_LEVEL_AUTO\n  }\n\n  constructor (options) {\n    super(options)\n    this._levels = []\n    this._pendingAdaptationEvent = false\n    this._isShakaReadyState = false\n    this._activeAudioLanguage = null\n\n    options.autoPlay && this.play()\n  }\n\n  play () {\n    if (!this._player) {\n      this._setup()\n    }\n\n    if (!this.isReady) {\n      this.once(DashShakaPlayback.Events.SHAKA_READY, this.play)\n      return\n    }\n\n    this._stopped = false\n    this._src = this.el.src\n    super.play()\n  }\n\n  // skipping setup `setupSrc` on tag video\n  setupSrc () {}\n\n  // skipping ready event on video tag in favor of ready on shaka\n  _ready () {\n    // override with no-op\n  }\n\n  _onShakaReady() {\n    this._isShakaReadyState = true\n    this.trigger(DashShakaPlayback.Events.SHAKA_READY)\n    this.trigger(Events.PLAYBACK_READY, this.name)\n  }\n\n  get isReady () {\n    return this._isShakaReadyState\n  }\n\n  // skipping error handling on video tag in favor of error on shaka\n  error (event) {\n    Log.error('an error was raised by the video tag', event, this.el.error)\n  }\n\n  isHighDefinitionInUse () {\n    return !!this.highDefinition\n  }\n\n  stop () {\n    clearInterval(this.sendStatsId)\n    this._stopped = true\n\n    if (this._player) {\n      this._sendStats()\n\n      this._player.unload().then(() => {\n        super.stop()\n        this._player = null\n        this._isShakaReadyState = false\n      }).catch(() => {\n        Log.error('shaka could not be unloaded')\n      })\n    } else {\n      super.stop()\n    }\n  }\n\n  /**\n  * Determine if the playback does not contain video/has video but video should be ignored.\n  * @property isAudioOnly\n  * @type Boolean\n  */\n  get isAudioOnly() {\n    return this.isReady ? this._player.isAudioOnly() : false\n  }\n\n  get textTracks () {\n    return this.isReady && this._player.getTextTracks()\n  }\n\n  get audioTracks () {\n    return this.isReady && this._player.getVariantTracks().filter((t) => t.mimeType.startsWith('audio/'))\n  }\n\n  get videoTracks () {\n    return this.isReady && this._player.getVariantTracks().filter((t) => t.mimeType.startsWith('video/'))\n  }\n\n  getPlaybackType () {\n    return (this.isReady && this._player.isLive() ? 'live' : 'vod') || ''\n  }\n\n  selectTrack (track, clearBuffer) {\n    if (!this.isReady) {\n      return false\n    }\n    switch(track.type) {\n    case 'text':\n      this._player.selectTextTrack(track)\n      return true\n    case 'variant':\n      this._player.selectVariantTrack(track, clearBuffer)\n      if (track.mimeType.startsWith('video/')) {\n        // we trigger the adaptation event here\n        // because Shaka doesn't trigger its event on \"manual\" selection.\n        this._onAdaptation()\n      }\n      return true\n    default:\n      throw new Error('Unhandled track type:', track.type)\n    }\n  }\n\n  selectLanguage(language, role) {\n    if (this.isReady) {\n      this._activeAudioLanguage = language\n      this._player.selectAudioLanguage(language, role)\n      return true\n    }\n    return false\n  }\n\n  get audioLanguages() {\n    return this.isReady && this._player.getAudioLanguages()\n  }\n\n  get activeAudioLanguage() {\n    return this._activeAudioLanguage || this.audioLanguages[0] || null\n  }\n\n  /**\n   * @override\n   */\n  get closedCaptionsTracks() {\n    let id = 0\n    let trackId = () => { return id++ }\n    let tracks = this.textTracks || []\n\n    return tracks\n      .filter(track => track.kind === 'subtitle')\n      .map(track => { return {id: trackId(), name: track.label || track.language, track: track} })\n  }\n\n  /**\n   * @override\n   */\n  get closedCaptionsTrackId() {\n    return super.closedCaptionsTrackId\n  }\n\n  /**\n   * @override\n   */\n  set closedCaptionsTrackId(trackId) {\n    if (!this._player) {\n      return\n    }\n\n    let tracks = this.closedCaptionsTracks\n    let showingTrack\n\n    // Note: -1 is for hide all tracks\n    if (trackId !== -1) {\n      showingTrack = tracks.find(track => track.id === trackId)\n      if (!showingTrack) {\n        Log.warn(`Track id \"${trackId}\" not found`)\n        return\n      }\n      if (this._shakaTTVisible && showingTrack.track.active === true) {\n        Log.info(`Track id \"${trackId}\" already showing`)\n        return\n      }\n    }\n\n    if (showingTrack) {\n      this._player.selectTextTrack(showingTrack.track)\n      this._enableShakaTextTrack(true)\n    } else {\n      this._enableShakaTextTrack(false)\n    }\n\n    this._ccTrackId = trackId\n    this.trigger(Events.PLAYBACK_SUBTITLE_CHANGED, {\n      id: trackId\n    })\n  }\n\n  _enableShakaTextTrack(isEnable) {\n    // Shaka player use only one TextTrack object with video element to handle all text tracks\n    // It must be enabled or disabled in addition to call selectTextTrack()\n    if (!this.el.textTracks) {\n      return\n    }\n\n    this._shakaTTVisible = isEnable\n\n    Array.from(this.el.textTracks)\n      .filter(track => track.kind === 'subtitles')\n      .forEach(track => track.mode = isEnable === true ? 'showing' : 'hidden')\n  }\n\n  _checkForClosedCaptions() {\n    if (this._ccIsSetup) {\n      return\n    }\n\n    if (this.hasClosedCaptionsTracks) {\n      this.trigger(Events.PLAYBACK_SUBTITLE_AVAILABLE)\n      const trackId = this.closedCaptionsTrackId\n      this.closedCaptionsTrackId = trackId\n    }\n    this._ccIsSetup = true\n  }\n\n  destroy () {\n    clearInterval(this.sendStatsId)\n\n    if (this._player) {\n      this._player.destroy()\n        .then(() => this._destroy())\n        .catch(() => {\n          this._destroy()\n          Log.error('shaka could not be destroyed')\n        })\n    } else {\n      this._destroy()\n    }\n  }\n\n  _setup () {\n    this._isShakaReadyState = false\n    this._ccIsSetup = false\n    this._player = this._createPlayer()\n    this._options.shakaConfiguration && this._player.configure(this._options.shakaConfiguration)\n    this._options.shakaOnBeforeLoad && this._options.shakaOnBeforeLoad(this._player)\n\n    const preferredAudioLanguage = this._player.getConfiguration().preferredAudioLanguage\n    this._activeAudioLanguage = preferredAudioLanguage.length ? preferredAudioLanguage : null\n\n    let playerLoaded = this._player.load(this._options.src)\n    playerLoaded.then(() => this._loaded())\n      .catch((e) => this._setupError(e))\n  }\n\n  _createPlayer () {\n    let player = new shaka.Player(this.el)\n    player.addEventListener('error', this._onError.bind(this))\n    player.addEventListener('adaptation', this._onAdaptation.bind(this))\n    player.addEventListener('buffering', this._onBuffering.bind(this))\n    return player\n  }\n\n  _onBuffering (e) {\n    if (this._stopped) return\n    let event = e.buffering ? Events.PLAYBACK_BUFFERING : Events.PLAYBACK_BUFFERFULL\n    this.trigger(event)\n  }\n\n  _loaded () {\n    this._onShakaReady()\n    this._startToSendStats()\n    this._fillLevels()\n    this._checkForClosedCaptions()\n  }\n\n  _fillLevels () {\n    if (this._levels.length === 0) {\n      this._levels = this.videoTracks.map((videoTrack) => { return {id: videoTrack.id, label: `${videoTrack.height}p`} }).reverse()\n      this.trigger(Events.PLAYBACK_LEVELS_AVAILABLE, this.levels)\n    }\n  }\n\n  _startToSendStats () {\n    const intervalMs = this._options.shakaSendStatsInterval || SEND_STATS_INTERVAL_MS\n    this.sendStatsId = setInterval(() => this._sendStats(), intervalMs)\n  }\n\n  _sendStats () {\n    this.trigger(Events.PLAYBACK_STATS_ADD, this._player.getStats())\n  }\n\n  _setupError (err) {\n    this._onError(err)\n  }\n\n  _onError (err) {\n    Log.error('Shaka error event:', err)\n    this.trigger(Events.PLAYBACK_ERROR, err, this.name)\n  }\n\n  _onAdaptation () {\n    let activeVideo = this.videoTracks.filter((t) => t.active === true)[0]\n\n    this._fillLevels()\n\n    // update stats that may have changed before we trigger event\n    // so that user can rely on stats data when handling event\n    this._sendStats()\n\n    if (this._pendingAdaptationEvent_) {\n      this.trigger(Events.PLAYBACK_LEVEL_SWITCH_END)\n      this._pendingAdaptationEvent = false\n    }\n\n    Log.debug('an adaptation has happened:', activeVideo)\n    this.highDefinition = (activeVideo.height >= 720)\n    this.trigger(Events.PLAYBACK_HIGHDEFINITIONUPDATE, this.highDefinition)\n    this.trigger(Events.PLAYBACK_BITRATE, {\n      bandwidth: activeVideo.bandwidth,\n      width: activeVideo.width,\n      height: activeVideo.height,\n      level: activeVideo.id\n    })\n  }\n\n  _destroy () {\n    super.destroy()\n    this._isShakaReadyState = false\n    Log.debug('shaka was destroyed')\n  }\n}\n\nexport default DashShakaPlayback\n\n\n\n// WEBPACK FOOTER //\n// ./src/clappr-dash-shaka-playback.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"amd\":\"clappr\",\"commonjs\":\"clappr\",\"commonjs2\":\"clappr\",\"root\":\"Clappr\"}\n// module id = 1\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shaka\"\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}